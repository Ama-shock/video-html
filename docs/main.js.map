{
  "version": 3,
  "sources": ["../src/BinaryCode.ts", "../src/serviceWorker.ts", "../src/window.ts", "../src/main.ts"],
  "sourcesContent": ["\n\nexport class BinaryCode extends Uint8Array {\n    static fromHex(hex: string): BinaryCode {\n        const bytes = new this(hex.length / 2);\n        for (let i = 0; i < hex.length; i += 2) {\n            bytes[i / 2] = parseInt(hex.slice(i, i + 2), 16);\n        }\n        return bytes;\n    }\n\n    static fromBase64(base64: string): BinaryCode {\n        const binaryString = atob(base64);\n        const bytes = new this(binaryString.length);\n        for (let i = 0; i < binaryString.length; i++) {\n            bytes[i] = binaryString.charCodeAt(i);\n        }\n        return bytes;\n    }\n\n    static fromBase64Url(base64url: string): BinaryCode {\n        const base64 = base64url.replace(/-/g, '+').replace(/_/g, '/');\n        const padding = '='.repeat((4 - (base64.length % 4)) % 4);\n        return this.fromBase64(base64 + padding);   \n    }\n\n    static fromText(text: string): BinaryCode {\n        const encoder = new TextEncoder();\n        const bytes = encoder.encode(text);\n        return new this(bytes);\n    }\n\n    toHex(): string {\n        return Array.from(this)\n            .map((byte) => byte.toString(16).padStart(2, '0'))\n            .join('');\n    }\n\n    toBase64(): string {\n        return btoa(String.fromCharCode(...this));\n    }\n\n    toBase64Url(): string {\n        const base64 = this.toBase64();\n        return base64.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n    }\n\n    toText(): string {\n        const decoder = new TextDecoder();\n        return decoder.decode(this);\n    }\n}\n", "\nexport async function initiateServiceWorker(global: ServiceWorkerGlobalScope) {\n    listenEvents(global, {\n        async push(ev) {\n            console.log('Caught Push Notification', ev);\n            const payload = ev.data?.text() || 'No payload';\n            await global.registration.showNotification('Test Push Notification', {\n                body: payload\n            });\n        },\n        async install(ev) {\n            console.log('SW installed', ev);\n            global.skipWaiting();\n        },\n        async activate(ev) {\n            console.log('SW activated', ev);\n            await global.clients.claim();\n        }\n    });\n}\n\nconst ServiceWorkerEvents = [\n    'activate',\n    'fetch',\n    'install',\n    'message',\n    'messageerror',\n    'notificationclick',\n    'notificationclose',\n    'push',\n    'pushsubscriptionchange',\n    'error',\n    'languagechange',\n    'offline',\n    'online',\n    'rejectionhandled',\n    'unhandledrejection',\n] as const;\n\n\ntype ServiceWorkerEvents = typeof ServiceWorkerEvents[number];\ntype ServiceWorkerEventListener<E extends ServiceWorkerEvents> = (event: ServiceWorkerGlobalScopeEventMap[E])=>(void|Promise<void>);\ntype ServiceWorkerListener = {\n    [E in ServiceWorkerEvents]?: ServiceWorkerEventListener<E>;\n};\n\nfunction listenEvents(global: ServiceWorkerGlobalScope, workerListener: ServiceWorkerListener) {\n    ServiceWorkerEvents.forEach(event => {\n        const eventListener = workerListener[event];\n        if (!eventListener) return;\n        global.addEventListener(event, ev => {\n            const result = eventListener(ev as any);\n            if ('waitUntil' in ev && result instanceof Promise) {\n                ev.waitUntil(result);\n            }\n        });\n    });\n}", "import 'normalize.css';\nimport './style.css';\nimport { BinaryCode } from './BinaryCode';\n\n// import { configureStore } from '@reduxjs/toolkit';\n\n// const store = configureStore({\n//     reducer\n// });\nexport async function registerDOM(window: Window) {\n    window.document.addEventListener('DOMContentLoaded', setDoms);\n    Object.defineProperty(window, 'subscribeNitification', { value: subscribeNitification });\n    Object.defineProperty(window, 'currentSubscription', { value: currentSubscription });\n    Object.defineProperty(window, 'unscribeNotification', { value: unscribeNotification });\n}\n\nasync function subscribeNitification(applicationServerKey: string) {\n    if (Notification.permission === 'default') {\n        const permission = await Notification.requestPermission();\n    }\n    if (Notification.permission !== 'granted') {\n        console.error('Permission denied');\n        return;\n    }\n    const registration = await navigator.serviceWorker.getRegistration();\n    if (!registration) {\n        console.error('Service worker not registered');\n        return;\n    }\n    const subscription = await registration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey\n    });\n    const key = subscription.getKey('p256dh');\n    const auth = subscription.getKey('auth');\n    const p256dh = key ? btoa(String.fromCharCode.apply(null, [...new Uint8Array(key)])) : '';\n    const authKey = auth ? btoa(String.fromCharCode.apply(null, [...new Uint8Array(auth)])) : '';\n    const endpoint = subscription.endpoint;\n    console.log('Subscription:', JSON.stringify({\n        endpoint,\n        keys: {\n            p256dh,\n            auth: authKey\n        }\n    }, null, 4));\n}\n\nasync function currentSubscription() {\n    const registration = await navigator.serviceWorker.getRegistration();\n    if (!registration) {\n        console.error('Service worker not registered');\n        return;\n    }\n    const subscription = await registration.pushManager.getSubscription();\n    if (!subscription) {\n        console.error('No subscription found');\n        return;\n    }\n    const p256dh = new BinaryCode(subscription.getKey('p256dh') ?? []).toBase64();\n    const authKey = new BinaryCode(subscription.getKey('auth') ?? []).toBase64();\n    const serverKey = new BinaryCode(subscription.options.applicationServerKey ?? []).toBase64Url();\n    console.log('Current Subscription:', {\n        serverKey,\n        endpoint: subscription.endpoint,\n        expirationTime: subscription.expirationTime,\n        keys: {\n            p256dh,\n            auth: authKey\n        }\n    });\n}\n\nasync function unscribeNotification() {\n    const registration = await navigator.serviceWorker.getRegistration();\n    if (!registration) {\n        console.error('Service worker not registered');\n        return;\n    }\n    const subscription = await registration.pushManager.getSubscription();\n    if (!subscription) {\n        console.error('No subscription found');\n        return;\n    }\n    await subscription.unsubscribe();\n    console.log('Unsubscribed', subscription);\n}\n\nfunction setDoms() { \n    const video = document.createElement('video');\n    video.width = 1920;\n    video.height = 1080;\n    video.autoplay = false;\n    video.controls = false;\n    video.volume = 1;\n    document.body.append(video);\n\n    const button = document.createElement('button');\n    button.innerText = 'start';\n    button.style.display = 'block';\n    document.body.append(button);\n    button.addEventListener('click', async () => {\n        document.body.removeChild(button);\n        await captureStream();\n        await enumerateDevices();\n        await captureStream();\n    }, { once: true });\n    \n\n    const volume = document.createElement('input');\n    volume.type = 'range';\n    volume.min = '0';\n    volume.max = '100';\n    volume.value = '100';\n    volume.addEventListener('change', ()=>{\n        video.volume = Number(volume.value) / 100;\n    });\n    document.body.append(volume);\n    \n    const videoSelect = document.createElement('select');\n    const audioSelect = document.createElement('select');\n\n    const fullScreen = document.createElement('button');\n    fullScreen.innerText = 'fullScreen';\n    fullScreen.addEventListener('click', () => document.querySelector('video')?.requestFullscreen() );\n    \n    async function enumerateDevices() {\n        const devices = await navigator.mediaDevices.enumerateDevices();\n\n        devices.filter(d=>d.kind === 'videoinput' && d.deviceId !== 'default' && d.deviceId !== 'communications')\n            .forEach(device=>{\n                const option = document.createElement('option');\n                option.value = device.deviceId;\n                option.innerText = device.label;\n                videoSelect.append(option);\n            });\n        document.body.append(videoSelect);\n        videoSelect.value = '';\n        videoSelect.addEventListener('change', captureStream);\n\n        devices.filter(d=>d.kind === 'audioinput' && d.deviceId !== 'default' && d.deviceId !== 'communications')\n            .forEach(device=>{\n                const option = document.createElement('option');\n                option.value = device.deviceId;\n                option.innerText = device.label;\n                audioSelect.append(option);\n            });\n        document.body.append(audioSelect);\n        audioSelect.value = '';\n        audioSelect.addEventListener('change', captureStream);\n\n        document.body.append(fullScreen);\n        \n        if(localStorage.videoDevice) videoSelect.value = localStorage.videoDevice;\n        if(localStorage.audioDevice) audioSelect.value = localStorage.audioDevice;\n    } \n\n    async function captureStream() {\n        const videoDevice = videoSelect.value || undefined;\n        const audioDevice = audioSelect.value || undefined;\n        if (video.srcObject instanceof MediaStream) {\n            video.srcObject.getTracks().forEach(track=>track.stop());\n        }\n        const stream = await navigator.mediaDevices.getUserMedia({\n            video: {\n                deviceId: videoDevice,\n                width: 1920,\n                height: 1080\n            },\n            audio: {\n                deviceId: audioDevice,\n                suppressLocalAudioPlayback: false,\n                echoCancellation: false,\n                noiseSuppression: false,\n                latency: 0\n            }\n        });\n\n        video.srcObject = stream;\n        await video.play();\n\n        if(videoDevice) localStorage.videoDevice = videoDevice;\n        if(audioDevice) localStorage.audioDevice = audioDevice;\n    }\n\n}\n", "import { BinaryCode } from \"./BinaryCode\";\nimport { initiateServiceWorker } from \"./serviceWorker\";\nimport { registerDOM } from \"./window\";\n\nObject.defineProperty(globalThis, 'BinaryCode', { value: BinaryCode });\nconst env = globalThis;\n\nif ('Window' in env && env instanceof Window) {\n    registerDOM(env);\n    const scriptSrc = (document.currentScript as HTMLScriptElement)?.src;\n    globalThis.navigator.serviceWorker.register(scriptSrc);\n}\n\nif ('ServiceWorkerGlobalScope' in env && env instanceof ServiceWorkerGlobalScope) {\n    initiateServiceWorker(env);\n}"],
  "mappings": "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",
  "names": []
}
